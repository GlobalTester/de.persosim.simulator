package de.persosim.simulator.perso;

import de.persosim.simulator.cardobjects.MasterFile;
import de.persosim.simulator.cardobjects.TrustPointCardObject;
import de.persosim.simulator.cardobjects.TrustPointIdentifier;
import de.persosim.simulator.crypto.certificates.CardVerifiableCertificate;
import de.persosim.simulator.exception.AccessDeniedException;
import de.persosim.simulator.exception.CertificateNotParseableException;
import de.persosim.simulator.protocols.ta.TerminalType;
import de.persosim.simulator.tlv.ConstructedTlvDataObject;
import de.persosim.simulator.utils.HexString;

/**
 * Standard personalization with same defaults used within the test PKI but with
 * trustpoints based on keys provided.
 * <p/>
 * This personalization is intended to be as close to the currently available
 * nPA as possible. During development the closest already supported
 * configuration is used.
 * 
 * @author amay
 * 
 */
public class DefaultPersoGt extends Profile01 {

	@Override
	protected void addTaTrustPoints(MasterFile mf) throws CertificateNotParseableException, AccessDeniedException {
		// certificates
		byte[] cvcaIsData = HexString
				.toByteArray("7F218201B07F4E8201685F290100420D444549534356434130303030317F4982011D060A04007F000702020202038120A9FB57DBA1EEA9BC3E660A909D838D726E3BF623D52620282013481D1F6E537782207D5A0975FC2C3057EEF67530417AFFE7FB8055C126DC5C6CE94A4B44F330B5D9832026DC5C6CE94A4B44F330B5D9BBD77CBF958416295CF7E1CE6BCCDC18FF8C07B68441048BD2AEB9CB7E57CB2C4B482FFC81B7AFB9DE27E1E3BD23C23A4453BD9ACE3262547EF835C3DAC4FD97F8461A14611DC9C27745132DED8E545C1D54C72F0469978520A9FB57DBA1EEA9BC3E660A909D838D718C397AA3B561A6F7901E0E82974856A7864104524770B0DDFBBA5A73E91E2562724F5A0CF1927A7333D1071BAB1120E8412EA2150DBDA7B85772BBA33C9FDD5637D303378A5A954CE6162488E4A5FF1EBABCF68701015F200D444549534356434130303030317F4C0E060904007F0007030102015301E35F25060105010100055F24060106010100055F3740422307D9B16408AB73E6F268B4FDDC30685641C571480A8123B0C6D2AAA9A902325CC87D93139924185320723A5D5A035F7A603B31664752C774A22B99C38D94");
		byte[] cvcaAtData = HexString
				.toByteArray("7F218201B47F4E82016C5F290100420D444541544356434130303030317F4982011D060A04007F000702020202038120A9FB57DBA1EEA9BC3E660A909D838D726E3BF623D52620282013481D1F6E537782207D5A0975FC2C3057EEF67530417AFFE7FB8055C126DC5C6CE94A4B44F330B5D9832026DC5C6CE94A4B44F330B5D9BBD77CBF958416295CF7E1CE6BCCDC18FF8C07B68441048BD2AEB9CB7E57CB2C4B482FFC81B7AFB9DE27E1E3BD23C23A4453BD9ACE3262547EF835C3DAC4FD97F8461A14611DC9C27745132DED8E545C1D54C72F0469978520A9FB57DBA1EEA9BC3E660A909D838D718C397AA3B561A6F7901E0E82974856A786410462DEB4D891CE0B3BA124FB0941786986245FE2AA2F482A30754E2B05F06136CB39D5237CE3805E88BD87293B877F39EF464792E053C6644D671A14FB0E058C908701015F200D444541544356434130303030317F4C12060904007F0007030102025305FE1FFFFFFF5F25060105010100055F24060106010100055F37408BD0D199516491AD5128AA65E5480412F5A55E4E40C8ED7D6173A4D5CD53B91013228A376F27B5D190A94367ACEF0C022FAE1B694AD106C443E2A0EF57A9ECCD");
		byte[] cvcaStData = HexString
				.toByteArray("7F218201B07F4E8201685F290100420D444553544356434130303030317F4982011D060A04007F000702020202038120A9FB57DBA1EEA9BC3E660A909D838D726E3BF623D52620282013481D1F6E537782207D5A0975FC2C3057EEF67530417AFFE7FB8055C126DC5C6CE94A4B44F330B5D9832026DC5C6CE94A4B44F330B5D9BBD77CBF958416295CF7E1CE6BCCDC18FF8C07B68441048BD2AEB9CB7E57CB2C4B482FFC81B7AFB9DE27E1E3BD23C23A4453BD9ACE3262547EF835C3DAC4FD97F8461A14611DC9C27745132DED8E545C1D54C72F0469978520A9FB57DBA1EEA9BC3E660A909D838D718C397AA3B561A6F7901E0E82974856A78641048DC4235B331A3284B46233D0575E707A3904045B0A67D119F332E7145A57C8B96EF68FBD1F5E675226B0715497C49D5122181C81626110A2EF36DC6BFA6215BB8701015F200D444553544356434130303030317F4C0E060904007F0007030102035301C35F25060105010100055F24060106010100055F37402384EDBEBAEE5B0128089FF3F9ACF1897898044662F6212F24B202799603BA9A05A8A41FC306A8467AEC4582C19EDDEDF6BA1E93980649506C931A68A23B8E0E");

		ConstructedTlvDataObject cvcaIsTlv = new ConstructedTlvDataObject(cvcaIsData);
		ConstructedTlvDataObject cvcaAtTlv = new ConstructedTlvDataObject(cvcaAtData);
		ConstructedTlvDataObject cvcaStTlv = new ConstructedTlvDataObject(cvcaStData);

		// TA trustpoints
		TrustPointCardObject trustPointIs = new TrustPointCardObject(new TrustPointIdentifier(TerminalType.IS),
				new CardVerifiableCertificate(cvcaIsTlv));
		mf.addChild(trustPointIs);

		TrustPointCardObject trustPointAt = new TrustPointCardObject(new TrustPointIdentifier(TerminalType.AT),
				new CardVerifiableCertificate(cvcaAtTlv));
		mf.addChild(trustPointAt);

		TrustPointCardObject trustPointSt = new TrustPointCardObject(new TrustPointIdentifier(TerminalType.ST),
				new CardVerifiableCertificate(cvcaStTlv));
		mf.addChild(trustPointSt);
	}
}
